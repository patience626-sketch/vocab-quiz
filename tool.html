<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>åŒ¯å…¥å·¥å…·ï¼ˆè¦ªå­ç‰ˆï¼‰</title>

  <!-- è·Ÿæ¸¬é©—é å…±ç”¨åŒä¸€å¥—å¯æ„›é¢¨ -->
  <link rel="stylesheet" href="./style.css" />

  <style>
    .page{ max-width:1100px; margin:0 auto; padding:0 14px; }
    .toolTop{
      display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap;
      padding:14px 16px; margin-bottom:14px;
    }
    .toolTitle{ display:flex;align-items:center;gap:12px; }
    .toolBadge{
      width:44px;height:44px;border-radius:16px;
      display:flex;align-items:center;justify-content:center;font-weight:1100;
      background: linear-gradient(135deg, rgba(99,102,241,0.18), rgba(236,72,153,0.14));
      border: 1px solid rgba(99,102,241,0.20);
    }
    .toolH1{ margin:0; font-size:18px; font-weight:1100; }
    .toolSub{ margin-top:2px; color:var(--muted); font-weight:850; font-size:13px; line-height:1.5; }

    .panel{ padding:14px; margin-bottom:14px; }
    .row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    .twoCol{ display:grid; grid-template-columns: 1fr; gap:12px; margin-top:12px; }
    @media(min-width: 980px){ .twoCol{ grid-template-columns: 1fr 1fr; } }

    textarea{
      width:100%;
      min-height: 320px;
      border:1px solid rgba(15,23,42,0.10);
      background: rgba(255,255,255,0.85);
      border-radius: 18px;
      padding: 12px 14px;
      font-size: 13px;
      font-weight: 850;
      color: var(--text);
      outline:none;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }
    textarea:focus{
      border-color: rgba(99,102,241,0.35);
      box-shadow: 0 0 0 4px rgba(99,102,241,0.10);
    }

    .boxTitle{ font-weight:1100; margin-bottom:8px; }
    .report{
      margin-top:12px;
      padding: 12px 14px;
      border-radius: 18px;
      border:1px solid rgba(15,23,42,0.08);
      background: rgba(255,255,255,0.75);
      font-weight: 1000;
      line-height: 1.7;
      color: var(--muted);
    }
    .ok{ color:#065f46; }
    .no{ color:#9f1239; }
    code{
      background: rgba(15,23,42,0.05);
      border: 1px solid rgba(15,23,42,0.08);
      padding:2px 8px;
      border-radius:999px;
      font-weight: 900;
    }
    .pillNote{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:8px 12px;
      border-radius:999px;
      background: rgba(99,102,241,0.10);
      border:1px solid rgba(99,102,241,0.18);
      color:#334155;
      font-weight: 1000;
      font-size: 13px;
      line-height: 1.4;
    }
  </style>
</head>

<body>
  <div class="bg">
    <div class="page">

      <header class="card toolTop">
        <div class="toolTitle">
          <div class="toolBadge">ğŸ“¥</div>
          <div>
            <h1 class="toolH1">åŒ¯å…¥å·¥å…·</h1>
            <div class="toolSub">è²¼ Excel è¡¨æ ¼ï¼ˆTSVï¼‰â†’ ä¸€éµè½‰æˆ <code>words.json</code>ï¼ˆè¦ªå­å¯æ„›ç‰ˆï¼‰</div>
          </div>
        </div>
        <div class="topActions">
          <a class="btn ghost" href="./index.html">ğŸ  å›æ¸¬é©—</a>
          <a class="btn ghost" href="./admin.html">ğŸ”§ å›å¾Œå°</a>
        </div>
      </header>

      <section class="card panel">
        <div class="row">
          <span class="pillNote">æ¬„ä½å›ºå®šï¼šA=idã€B=ä¸­æ–‡ã€C=è‹±æ–‡ã€D=åœ–ç‰‡è·¯å¾‘ã€E=åˆ†é¡</span>
          <span class="pillNote">åœ–ç‰‡è·¯å¾‘ä¾‹ï¼š<code>images/apple.jpg</code></span>
        </div>

        <div class="row" style="margin-top:12px;">
          <button id="btnConvert" class="btn primary">è½‰æ›æˆ JSON</button>
          <button id="btnDownload" class="btn" disabled>ä¸‹è¼‰ words.json</button>
          <button id="btnClear" class="btn ghost">æ¸…ç©º</button>
        </div>

        <div class="twoCol">
          <div class="card" style="padding:14px;">
            <div class="boxTitle">â‘  è²¼ä¸Š Excel è¡¨æ ¼</div>
            <textarea id="input" placeholder="å¾ Excel è¤‡è£½å¾Œç›´æ¥è²¼åœ¨é€™è£¡ï¼ˆæ¯åˆ—ä¸€ç­†ï¼‰"></textarea>
          </div>

          <div class="card" style="padding:14px;">
            <div class="boxTitle">â‘¡ è½‰æ›è¼¸å‡ºï¼ˆJSONï¼‰</div>
            <textarea id="output" placeholder="æŒ‰ã€Œè½‰æ›æˆ JSONã€å¾Œæœƒå‡ºç¾åœ¨é€™è£¡" readonly></textarea>
          </div>
        </div>

        <div id="report" class="report"></div>
      </section>

      <footer class="footer">
        åŒ¯å…¥ï¼ˆtool.htmlï¼‰ï½œå¾Œå°ï¼ˆadmin.htmlï¼‰ï½œæ¸¬é©—ï¼ˆindex.htmlï¼‰
      </footer>
    </div>
  </div>

<script>
  const FIXED = ["æ°´æœ","å‹•ç‰©","äº¤é€šå·¥å…·","é£Ÿç‰©","é¡è‰²","èº«é«”","å®¶åº­","å­¸æ ¡ç”¨å“","è‡ªç„¶","é‹å‹•","è·æ¥­","å…¶ä»–"];
  const FIXED_SET = new Set(FIXED);

  const input = document.getElementById("input");
  const output = document.getElementById("output");
  const report = document.getElementById("report");
  const btnConvert = document.getElementById("btnConvert");
  const btnDownload = document.getElementById("btnDownload");
  const btnClear = document.getElementById("btnClear");

  function norm(s){ return String(s||"").trim(); }
  function normalizeCat(c){
    c = norm(c);
    return FIXED_SET.has(c) ? c : "";
  }

  function download(filename, text){
    const blob = new Blob([text], {type:"application/json;charset=utf-8"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
  }

  function parseTSV(text){
    const lines = text.split(/\r?\n/).filter(l => l.trim().length);
    const rows = lines.map(line => line.split("\t"));
    return rows;
  }

  function setReport(html){
    report.innerHTML = html;
  }

  function convert(){
    const text = input.value || "";
    if (!text.trim()){
      output.value = "";
      btnDownload.disabled = true;
      setReport(`<span class="no">âš ï¸ æ²’æœ‰è²¼ä¸Šä»»ä½•è³‡æ–™</span>`);
      return;
    }

    const rows = parseTSV(text);
    const out = [];
    const seen = new Set();

    let dup = 0, missing = 0, badCat = 0;

    for (const r of rows){
      const id = norm(r[0]);
      const zh = norm(r[1]);
      const en = norm(r[2]);
      const img = norm(r[3]);
      const catRaw = norm(r[4]);
      const cat = normalizeCat(catRaw);

      if (!id || !zh || !en){
        missing++;
        continue;
      }
      if (seen.has(id)){
        dup++;
        continue;
      }
      seen.add(id);

      if (catRaw && !cat) badCat++;

      out.push({ id, zh, en, img, cat });
    }

    const json = JSON.stringify(out, null, 2);
    output.value = json;
    btnDownload.disabled = out.length === 0;

    setReport(
      `<div><span class="ok">âœ… è½‰æ›å®Œæˆï¼š${out.length} ç­†</span></div>
       <div>é‡è¤‡ id è·³éï¼š${dup}ï½œç¼ºæ¬„ä½è·³éï¼š${missing}ï½œåˆ†é¡ä¸åœ¨æ¸…å–®ï¼ˆæœƒè®Šæœªåˆ†é¡ï¼‰ï¼š${badCat}</div>
       <div style="margin-top:6px;">ä¸‹è¼‰å¾Œè«‹å› repo è¦†è“‹æ ¹ç›®éŒ„çš„ <code>words.json</code>ï¼ˆæ¸¬é©—é å°±æœƒæ›´æ–°ï¼‰ã€‚</div>`
    );
  }

  btnConvert.addEventListener("click", convert);
  btnDownload.addEventListener("click", () => download("words.json", output.value));
  btnClear.addEventListener("click", () => {
    input.value = "";
    output.value = "";
    btnDownload.disabled = true;
    setReport("");
  });
</script>
</body>
</html>
