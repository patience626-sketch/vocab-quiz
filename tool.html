<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>words.json åŒ¯å…¥å·¥å…·ï¼ˆè²¼è¡¨æ ¼ï¼‰</title>
  <style>
    :root{--bg:#f6f7fb;--card:#fff;--text:#111827;--muted:#6b7280;--bd:#e5e7eb;--dark:#111827}
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans TC",sans-serif;background:var(--bg);color:var(--text)}
    .wrap{max-width:980px;margin:18px auto;padding:0 14px}
    .card{background:var(--card);border:1px solid var(--bd);border-radius:18px;padding:14px}
    h1{margin:0 0 8px;font-size:18px}
    textarea{width:100%;min-height:220px;border:1px solid var(--bd);border-radius:14px;padding:12px;font-size:13px;font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;background:#fff}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-top:10px}
    .btn{border:1px solid var(--bd);background:#fff;border-radius:12px;padding:10px 12px;cursor:pointer;font-weight:900;text-decoration:none;display:inline-flex;align-items:center;justify-content:center;gap:6px}
    .btn.primary{background:var(--dark);color:#fff;border-color:var(--dark)}
    .muted{color:var(--muted);font-weight:700;line-height:1.6}
    code{background:#f3f4f6;padding:2px 6px;border-radius:8px;border:1px solid var(--bd)}
    .box{border:1px dashed var(--bd);border-radius:14px;padding:12px;background:#fff}
    .warn{color:#9f1239;font-weight:900}
    .ok{color:#065f46;font-weight:900}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>words.json åŒ¯å…¥å·¥å…·ï¼ˆè²¼ Excel è¡¨æ ¼ï¼‰</h1>
      <div class="muted">
        è«‹å¾ Excel è¤‡è£½è²¼ä¸Šï¼ˆTSVï¼‰ï¼š<br/>
        <code>A=id</code>ã€<code>B=ä¸­æ–‡</code>ã€<code>C=è‹±æ–‡</code>ã€<code>D=åœ–ç‰‡è·¯å¾‘</code>ï¼ˆä¾‹ï¼šimages/apple.jpgï¼‰ã€<code>E=åˆ†é¡</code><br/>
        åˆ†é¡åªæ¥å—ï¼š<code>æ°´æœ/å‹•ç‰©/äº¤é€šå·¥å…·/é£Ÿç‰©/é¡è‰²/èº«é«”/å®¶åº­/å­¸æ ¡ç”¨å“/è‡ªç„¶/é‹å‹•/è·æ¥­/å…¶ä»–</code>ï¼Œä¸ç¬¦åˆå°±æœƒè®Šæˆæœªåˆ†é¡ã€‚
      </div>

      <div class="row">
        <a class="btn" href="./index.html">â† å›æ¸¬é©—é </a>
        <a class="btn" href="./admin.html">ğŸ”§ å›å¾Œå°</a>
        <button id="btnConvert" class="btn primary">è½‰æ›æˆ JSON</button>
        <button id="btnDownload" class="btn" disabled>ä¸‹è¼‰ words.json</button>
        <button id="btnClear" class="btn">æ¸…ç©º</button>
      </div>

      <div class="row">
        <div class="box" style="flex:1;min-width:280px;">
          <div style="font-weight:900;margin-bottom:6px;">è²¼ä¸Šè¡¨æ ¼</div>
          <textarea id="input" placeholder="åœ¨æ­¤è²¼ä¸Š Excel è¡¨æ ¼ï¼ˆå«å¤šåˆ—ï¼‰"></textarea>
        </div>
        <div class="box" style="flex:1;min-width:280px;">
          <div style="font-weight:900;margin-bottom:6px;">è¼¸å‡º JSON</div>
          <textarea id="output" placeholder="æŒ‰ã€Œè½‰æ›æˆ JSONã€å¾Œæœƒå‡ºç¾åœ¨é€™è£¡" readonly></textarea>
        </div>
      </div>

      <div id="report" class="muted" style="margin-top:10px;"></div>
    </div>
  </div>

<script>
  const FIXED = ["æ°´æœ","å‹•ç‰©","äº¤é€šå·¥å…·","é£Ÿç‰©","é¡è‰²","èº«é«”","å®¶åº­","å­¸æ ¡ç”¨å“","è‡ªç„¶","é‹å‹•","è·æ¥­","å…¶ä»–"];
  const FIXED_SET = new Set(FIXED);

  const input = document.getElementById("input");
  const output = document.getElementById("output");
  const report = document.getElementById("report");
  const btnConvert = document.getElementById("btnConvert");
  const btnDownload = document.getElementById("btnDownload");
  const btnClear = document.getElementById("btnClear");

  function norm(s){ return String(s||"").trim(); }
  function normalizeCat(c){
    c = norm(c);
    return FIXED_SET.has(c) ? c : "";
  }

  function download(filename, text){
    const blob = new Blob([text], {type:"application/json;charset=utf-8"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
  }

  function parseTSV(text){
    const lines = text.split(/\r?\n/).filter(l => l.trim().length);
    const rows = lines.map(line => line.split("\t"));
    return rows;
  }

  function convert(){
    report.innerHTML = "";
    const text = input.value || "";
    if (!text.trim()){
      output.value = "";
      btnDownload.disabled = true;
      report.innerHTML = `<div class="warn">âš ï¸ æ²’æœ‰è²¼ä¸Šä»»ä½•è³‡æ–™</div>`;
      return;
    }

    const rows = parseTSV(text);
    const out = [];
    const seen = new Set();

    let dup = 0, missing = 0, badCat = 0;

    for (const r of rows){
      const id = norm(r[0]);
      const zh = norm(r[1]);
      const en = norm(r[2]);
      const img = norm(r[3]);
      const catRaw = norm(r[4]);
      const cat = normalizeCat(catRaw);

      if (!id || !zh || !en){
        missing++;
        continue;
      }
      if (seen.has(id)){
        dup++;
        continue;
      }
      seen.add(id);

      if (catRaw && !cat) badCat++;

      out.push({ id, zh, en, img, cat });
    }

    const json = JSON.stringify(out, null, 2);
    output.value = json;
    btnDownload.disabled = out.length === 0;

    report.innerHTML =
      `<div class="ok">âœ… è½‰æ›å®Œæˆï¼š${out.length} ç­†</div>` +
      `<div>é‡è¤‡ id è·³éï¼š${dup} ç­†ï½œç¼ºæ¬„ä½è·³éï¼š${missing} ç­†ï½œåˆ†é¡ä¸åœ¨æ¸…å–®ï¼ˆæœƒè®Šæœªåˆ†é¡ï¼‰ï¼š${badCat} ç­†</div>` +
      `<div class="muted">ä¸‹è¼‰å¾Œè«‹å› repo è¦†è“‹æ ¹ç›®éŒ„ <code>words.json</code></div>`;
  }

  btnConvert.addEventListener("click", convert);
  btnDownload.addEventListener("click", () => download("words.json", output.value));
  btnClear.addEventListener("click", () => { input.value=""; output.value=""; report.innerHTML=""; btnDownload.disabled=true; });
</script>
</body>
</html>
